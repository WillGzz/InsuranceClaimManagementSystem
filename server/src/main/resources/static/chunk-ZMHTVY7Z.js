import{a as G}from"./chunk-Q3YSATQQ.js";import{D as M,J as v,K as C,L as F,M as T,N as V,O as g,P as o,Q as n,R as h,S as D,T as _,U as c,W as y,X as a,Y as b,Z as f,_ as U,ba as A,c as P,ca as j,e as k,ea as q,fa as O,ia as H,ja as $,k as S,l as m,m as p,o as R,p as x,pa as B,ra as K,u as s,va as z,z as W}from"./chunk-TP7LHYW3.js";import{a as w,b as N}from"./chunk-7CGTOI24.js";function J(r,t){let i=!t?.manualCleanup?t?.injector?.get(R)??S(R):null,l=X(t?.equal),d;t?.requireSync?d=x({kind:0},{equal:l}):d=x({kind:1,value:t?.initialValue},{equal:l});let I,L=r.subscribe({next:E=>d.set({kind:1,value:E}),error:E=>{d.set({kind:2,error:E}),I?.()},complete:()=>{I?.()}});if(t?.requireSync&&d().kind===0)throw new k(601,!1);return I=i?.onDestroy(L.unsubscribe.bind(L)),q(()=>{let E=d();switch(E.kind){case 1:return E.value;case 2:throw E.error;case 0:throw new k(601,!1)}},{equal:t?.equal})}function X(r=Object.is){return(t,e)=>t.kind===1&&e.kind===1&&r(t.value,e.value)}var Y=(r,t)=>t.id;function Z(r,t){if(r&1){let e=D();o(0,"button",17),_("click",function(){m(e);let l=c(2);return p(l.onDelete())}),a(1," Delete "),n()}}function ee(r,t){if(r&1&&(o(0,"div")(1,"span",6),a(2,"Estimate:"),n(),a(3),A(4,"number"),n()),r&2){let e=c(3);s(3),f(" ",j(4,1,e.estimate()??0,"1.2-2")," ")}}function te(r,t){if(r&1&&(o(0,"div")(1,"span",6),a(2,"Risk:"),n(),o(3,"span",18),a(4),n()(),M(5,ee,5,4,"div",19)),r&2){let e=c(),i=c();s(3),y((e.riskScore??0)>=61?"bg-red-100 text-sm ml-1 pr-4 pt-0 text-red-700":(e.riskScore??0)>=31?"bg-amber-100 text-sm ml-1 pr-4 pt-0 text-amber-700":"bg-green-100 text-sm ml-1 pr-4 pt-0 pb-0.5 text-green-700"),s(),f(" ",(e.riskScore??0)>=61?"HIGH":(e.riskScore??0)>=31?"MED":"LOW"," "),s(),g("ngIf",i.estimate()!=null)}}function ne(r,t){if(r&1&&(o(0,"div")(1,"span",6),a(2,"SLA Due:"),n(),a(3),n()),r&2){let e=c();s(3),f(" ",e.slaDueAt)}}function ie(r,t){if(r&1&&(o(0,"option",23),a(1),n()),r&2){let e=t.$implicit;g("value",e),s(),b(e)}}function oe(r,t){if(r&1){let e=D();o(0,"div",5)(1,"div",20)(2,"label",21),a(3,"Update Status"),n(),o(4,"select",22),_("change",function(l){m(e);let d=c(2);return p(d.onStatusChange(l))}),T(5,ie,2,2,"option",23,F),n()(),o(7,"div",24)(8,"label",21),a(9,"Assignee"),n(),o(10,"input",25),_("input",function(l){m(e);let d=c(2);return p(d.onAssigneeInput(l))}),n()(),o(11,"button",26),_("click",function(){m(e);let l=c(2);return p(l.save())}),a(12,"Save"),n()()}if(r&2){let e=c(2);s(4),g("value",e.status()),s(),V(e.statuses),s(5),g("value",e.assignee())}}function re(r,t){if(r&1){let e=D();o(0,"section",8)(1,"h3",10),a(2,"Adjuster Tools"),n(),o(3,"div",27)(4,"div")(5,"label",21),a(6,"Internal Note"),n(),o(7,"textarea",28),_("input",function(l){m(e);let d=c(2);return p(d.onNoteInput(l))}),n(),o(8,"div",29)(9,"button",30),_("click",function(){m(e);let l=c(2);return p(l.addNote())}),a(10,"Add Note"),n()()(),o(11,"div")(12,"label",21),a(13,"Preliminary Estimate (USD)"),n(),o(14,"input",31),_("input",function(l){m(e);let d=c(2);return p(d.onEstimateInput(l))}),n(),o(15,"div",32)(16,"button",30),_("click",function(){m(e);let l=c(2);return p(l.saveEstimate())}),a(17,"Save Estimate"),n(),o(18,"button",33),_("click",function(){m(e);let l=c(2);return p(l.startReview())}),a(19," Start Review "),n()()()()()}if(r&2){let e=c(2);s(7),g("value",e.adjusterNote()),s(7),g("value",e.estimate()??""),s(4),g("disabled",!e.canStartReview()||e.savingReview())}}function ae(r,t){if(r&1){let e=D();o(0,"button",39),_("click",function(){m(e);let l=c().$implicit,d=c(4);return p(d.deleteNote(l.id))}),a(1," Delete "),n()}}function se(r,t){if(r&1&&(o(0,"li",36)(1,"div",14)(2,"div",37),a(3),n(),o(4,"div",16),a(5),n()(),v(6,ae,2,0,"button",38),n()),r&2){let e=t.$implicit,i=c(4);s(3),b(e.text),s(2),U("",e.authorRole," \u2014 ",e.createdAt),s(),C(i.roleSvc.role()==="Adjuster"?6:-1)}}function le(r,t){if(r&1&&(o(0,"ul",34),T(1,se,7,4,"li",36,Y),n()),r&2){let e=c(3);s(),V(e.notes())}}function de(r,t){r&1&&(o(0,"div",35),a(1,"No internal notes yet."),n())}function ce(r,t){if(r&1&&(o(0,"section",8)(1,"h3",10),a(2,"Internal Notes"),n(),v(3,le,3,0,"ul",34)(4,de,2,0,"div",35),n()),r&2){let e=c(2);s(3),C(e.notes().length?3:4)}}function ue(r,t){if(r&1&&(o(0,"div",1)(1,"h2",2),a(2),n(),M(3,Z,2,0,"button",3),n(),o(4,"div",4)(5,"div",5)(6,"div")(7,"span",6),a(8,"Policy:"),n(),o(9,"b"),a(10),n()(),o(11,"div")(12,"span",6),a(13,"Status:"),n(),o(14,"span",7),a(15),n()(),v(16,te,6,4),o(17,"div")(18,"span",6),a(19,"Loss:"),n(),a(20),n(),o(21,"div")(22,"span",6),a(23,"Reported:"),n(),a(24),n(),o(25,"div")(26,"span",6),a(27,"Amount:"),n(),a(28),A(29,"number"),n(),v(30,ne,4,1,"div"),n(),v(31,oe,13,2,"div",5),n(),v(32,re,20,3,"section",8),v(33,ce,5,1,"section",8),o(34,"section",9)(35,"h3",10),a(36,"Claim Progress"),n(),o(37,"ul",11)(38,"li",12),h(39,"span",13),o(40,"div",14)(41,"div",15),a(42,"Filed"),n(),o(43,"div",16),a(44),n()()(),o(45,"li",12),h(46,"span",13),o(47,"div",14)(48,"div",15),a(49,"Under Review"),n(),o(50,"div",16),a(51),n()()(),o(52,"li",12),h(53,"span",13),o(54,"div",14)(55,"div",15),a(56,"Decision"),n(),o(57,"div",16),a(58),n()()()()()),r&2){let e=t,i=c();s(2),f("Claim #",e.id),s(),g("ngIf",i.roleSvc.role()==="Manager"),s(7),b(e.policyNumber),s(4),y(i.statusClass(e.status)),s(),b(e.status),s(),C(i.roleSvc.role()!=="Customer"?16:-1),s(4),f(" ",e.lossDate),s(4),f(" ",e.reportedDate),s(4),f(" ",j(29,23,e.amount,"1.2-2")),s(2),C(e.slaDueAt?30:-1),s(),C(i.roleSvc.role()!=="Customer"&&i.roleSvc.role()!=="Auditor"&&i.roleSvc.role()!=="Adjuster"?31:-1),s(),C(i.roleSvc.role()==="Adjuster"?32:-1),s(),C(i.roleSvc.role()!=="Customer"?33:-1),s(6),y(i.dot(i.stepDone("FILED"))),s(5),b(e.reportedDate),s(2),y(i.dot(i.stepDone("REVIEW"))),s(5),b(e.updatedAt||"\u2014"),s(2),y(i.dot(i.stepDone("DECISION"))),s(5),b(e.updatedAt||"\u2014")}}function me(r,t){r&1&&(o(0,"div",0),a(1,"Loading\u2026"),n())}var u=class u{constructor(){this.route=S(B);this.api=S(G);this.router=S(K);this.roleSvc=S(z);this._notesArr=x([]);this.notes=this._notesArr.asReadonly();this.estimate=x(null);this.savingReview=x(!1);this.id=J(this.route.paramMap.pipe(P(t=>Number(t.get("id")))),{initialValue:0});this.claim=x(null);this.statuses=["NEW","IN_REVIEW","APPROVED","DENIED","CLOSED"];this.status=x("NEW");this.assignee=x("");this.adjusterNote=x("");this.load=O(()=>{let t=this.id();t&&this.api.get(t).subscribe(e=>{this.claim.set(e),this.status.set(e.status),this.assignee.set(e.assignee??""),u.notesStore[t]||(u.notesStore[t]=[]),this._notesArr.set(u.notesStore[t]);let i=u.estimateStore[t];this.estimate.set(i??null)})});this.statusClass=t=>({NEW:"bg-sky-100 text-sm py-0.2 pr-4  text-sky-700 ring-1 ring-sky-200",IN_REVIEW:"bg-amber-100 text-sm py-0.2 pr-4 text-amber-700 ring-1 ring-amber-200",APPROVED:"bg-emerald-100 text-sm py-0.2 pr-4  text-emerald-700 ring-1 ring-emerald-200",DENIED:"bg-rose-100 text-sm py-0.2 pr-4 text-rose-700 ring-1 ring-rose-200",CLOSED:"bg-slate-200 text-sm py-0.2 pr-4 text-slate-700 ring-1 ring-slate-300"})[t]??"bg-gray-200 text-sm py-0.2 pr-4 text-gray-700 ring-1 ring-gray-300"}stepDone(t){let e=this.claim()?.status;return e?t==="FILED"?!0:t==="REVIEW"?e==="IN_REVIEW"||e==="APPROVED"||e==="DENIED"||e==="CLOSED":e==="APPROVED"||e==="DENIED"||e==="CLOSED":!1}dot(t){return t?"bg-blue-600":"bg-gray-300"}save(){if(this.roleSvc.role()!=="Manager")return;let t=this.claim();if(!t)return;let e={},i=this.status();i&&(e.status=i);let l=this.assignee();l&&(e.assignee=l),this.api.update(t.id,e).subscribe({next:d=>{this.claim.set(d),this.status.set(d.status),this.assignee.set(d.assignee??"")},error:d=>console.error("Update claim failed",d)})}onNoteInput(t){this.adjusterNote.set(t.target.value??"")}onEstimateInput(t){let e=t.target.value;this.estimate.set(e===""?null:Number(e))}addNote(){let t=(this.adjusterNote()||"").trim(),e=this.claim();if(!e||!t)return;let i=u.notesStore[e.id]??(u.notesStore[e.id]=[]);i.push({id:u.nextId++,text:t,authorRole:"Adjuster",createdAt:new Date().toLocaleString()}),this._notesArr.set([...i]),this.adjusterNote.set("")}deleteNote(t){let e=this.claim();if(!e)return;let l=(u.notesStore[e.id]??[]).filter(d=>d.id!==t);u.notesStore[e.id]=l,this._notesArr.set([...l])}canStartReview(){return(this.claim()?.status??"NEW")==="NEW"}startReview(){let t=this.claim();!t||!this.canStartReview()||(this.savingReview.set(!0),this.api.update(t.id,{status:"IN_REVIEW"}).subscribe({next:e=>{this.claim.set(e),this.status.set(e.status)},error:e=>{let i=N(w({},t),{status:"IN_REVIEW"});this.claim.set(i),this.status.set("IN_REVIEW")},complete:()=>this.savingReview.set(!1)}))}saveEstimate(){let t=this.estimate(),e=this.claim();if(!e)return;if(t==null||isNaN(t)){delete u.estimateStore[e.id],this.estimate.set(null);return}let i=Math.round(t*100)/100;u.estimateStore[e.id]=i,this.estimate.set(i),this.api.update(e.id,{}).subscribe({next:()=>{},error:l=>console.warn("Backend doesn't support estimate; keeping local only.")})}onStatusChange(t){this.status.set(t.target.value)}onAssigneeInput(t){this.assignee.set(t.target.value??"")}onDelete(){let t=this.claim();t&&confirm(`Delete claim #${t.id}?`)&&this.api.delete(t.id).subscribe({next:()=>this.router.navigate(["/claims"]),error:e=>alert("Delete failed (check role/server): "+(e?.error?.message??e.statusText??e))})}};u.notesStore={},u.estimateStore={},u.nextId=1,u.\u0275fac=function(e){return new(e||u)},u.\u0275cmp=W({type:u,selectors:[["app-claim-detail"]],decls:2,vars:1,consts:[[1,"text-sm","text-gray-600"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-xl","font-semibold"],["class","px-3 py-2 rounded bg-red-600 text-white text-sm cursor-pointer",3,"click",4,"ngIf"],[1,"grid","grid-cols-2","gap-4","mb-6"],[1,"p-3","border","rounded"],[1,"text-gray-500"],[1,"ml-1","px-2","rounded"],[1,"border","rounded","p-4","mb-6"],[1,"border","rounded","p-4"],[1,"font-semibold","mb-3"],[1,"space-y-3"],[1,"flex","items-center","gap-3"],[1,"w-3","h-3","rounded-full"],[1,"flex-1"],[1,"font-medium"],[1,"text-xs","text-gray-500"],[1,"px-3","py-2","rounded","bg-red-600","text-white","text-sm","cursor-pointer",3,"click"],[1,"px-2","py-0.5","rounded"],[4,"ngIf"],[1,"mb-2"],[1,"block","text-sm","text-gray-700","mb-1"],[1,"w-full","border","rounded","px-3","py-2",3,"change","value"],[3,"value"],[1,"mb-4"],[1,"w-full","border","rounded","px-3","py-2",3,"input","value"],[1,"px-3","py-2","rounded","bg-blue-600","text-white","cursor-pointer",3,"click"],[1,"grid","grid-cols-2","gap-4"],["rows","3","placeholder","Only visible to staff (not customers)",1,"w-full","border","rounded","px-3","py-2",3,"input","value"],[1,"mt-2"],[1,"px-3","py-2","rounded","border","cursor-pointer",3,"click"],["type","number",1,"w-full","border","rounded","px-3","py-2",3,"input","value"],[1,"mt-2","space-x-2"],[1,"px-3","py-2","rounded","bg-amber-600","text-white","cursor-pointer",3,"click","disabled"],[1,"space-y-2"],[1,"text-sm","text-gray-500"],[1,"text-sm","flex","items-start","justify-between","gap-3"],[1,"text-gray-800"],[1,"text-rose-600","text-xs","hover:underline","cursor-pointer"],[1,"text-rose-600","text-xs","hover:underline","cursor-pointer",3,"click"]],template:function(e,i){if(e&1&&v(0,ue,59,26)(1,me,2,0,"div",0),e&2){let l;C((l=i.claim())?0:1,l)}},dependencies:[H,$],encapsulation:2,changeDetection:0});var Q=u;export{Q as ClaimDetailComponent};
