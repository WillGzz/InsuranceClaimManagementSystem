import{a as H}from"./chunk-Q3YSATQQ.js";import{D as E,J as d,K as p,M as N,N as R,O as C,P as o,Q as n,R as w,S,T as _,U as m,W as L,X as a,Y as g,Z as D,aa as V,ba as M,ca as j,ea as $,ia as O,ja as F,k as f,l as v,m as k,ma as q,p as y,sa as A,u as s,va as P,z as T}from"./chunk-TP7LHYW3.js";import"./chunk-7CGTOI24.js";var G=r=>["/claims",r],z=(r,e)=>e.id;function J(r,e){if(r&1){let t=S();o(0,"button",9),_("click",function(){v(t);let l=m();return k(l.exportCsv())}),a(1," Export CSV "),n()}}function K(r,e){if(r&1){let t=S();o(0,"button",10),_("click",function(){v(t);let l=m();return k(l.resetData())}),a(1," Reset Seed Data "),n()}}function Q(r,e){r&1&&(o(0,"a",6),a(1,"+ New Claim"),n())}function X(r,e){r&1&&(o(0,"th",12),a(1,"Risk"),n())}function Y(r,e){if(r&1&&(o(0,"td",13)(1,"span",15),a(2),n()()),r&2){let t=m().$implicit,i=m(2);s(),L(i.riskClass(t.riskScore??0)),s(),D(" ",i.riskLabel(t.riskScore??0)," ")}}function Z(r,e){if(r&1){let t=S();o(0,"button",19),_("click",function(){v(t);let l=m().$implicit,x=m(2);return k(x.onDelete(l.id))}),a(1,"Delete"),n()}}function ee(r,e){if(r&1&&(o(0,"tr",14)(1,"td",13),a(2),n(),o(3,"td",13),a(4),n(),o(5,"td",13),a(6),n(),o(7,"td",13),a(8),M(9,"number"),n(),o(10,"td",13)(11,"span",15),a(12),n()(),d(13,Y,3,3,"td",13),o(14,"td",16)(15,"a",17),a(16,"Open"),n(),E(17,Z,2,0,"button",18),n()()),r&2){let t=e.$implicit,i=m(2);s(2),g(t.id),s(2),g(t.policyNumber),s(2),g(t.lossDate),s(2),g(j(9,10,t.amount,"1.2-2")),s(3),L(i.statusClass(t.status)),s(),D(" ",t.status," "),s(),p(i.roleSvc.role()!=="Customer"?13:-1),s(2),C("routerLink",V(13,G,t.id)),s(2),C("ngIf",i.roleSvc.role()==="Manager")}}function te(r,e){if(r&1&&(o(0,"table",7)(1,"thead",11)(2,"tr")(3,"th",12),a(4,"ID"),n(),o(5,"th",12),a(6,"Policy"),n(),o(7,"th",12),a(8,"Loss Date"),n(),o(9,"th",12),a(10,"Amount"),n(),o(11,"th",12),a(12,"Status"),n(),d(13,X,2,0,"th",12),w(14,"th",13),n()(),o(15,"tbody"),N(16,ee,18,15,"tr",14,z),n()()),r&2){let t=m();s(13),p(t.roleSvc.role()!=="Customer"?13:-1),s(3),R(t.rows())}}function ie(r,e){r&1&&(o(0,"div",8),a(1,"No claims yet."),n())}var u=class u{constructor(){this.api=f(H);this.roleSvc=f(P);this.http=f(q);this.all=y([]);this.q=y("");this.rows=$(()=>{let e=this.q().trim().toLowerCase(),t=this.all();return e?t.filter(i=>`${i.id}`.includes(e)||(i.policyNumber??"").toLowerCase().includes(e)||(i.status??"").toLowerCase().includes(e)||(i.assignee??"").toLowerCase().includes(e)):t});this.statusClass=e=>({NEW:"bg-sky-100 text-sky-700 ring-1 ring-sky-200 dark:bg-sky-900/30 dark:text-sky-300 dark:ring-sky-800/60",IN_REVIEW:"bg-amber-100 text-amber-700 ring-1 ring-amber-200 dark:bg-amber-900/30 dark:text-amber-300 dark:ring-amber-800/60",APPROVED:"bg-emerald-100 text-emerald-700 ring-1 ring-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-300 dark:ring-emerald-800/60",DENIED:"bg-rose-100 text-rose-700 ring-1 ring-rose-200 dark:bg-rose-900/30 dark:text-rose-300 dark:ring-rose-800/60",CLOSED:"bg-slate-200 text-slate-700 ring-1 ring-slate-300 dark:bg-slate-900/30 dark:text-slate-300 dark:ring-slate-800/60"})[e]??"bg-gray-200 text-gray-700 ring-1 ring-gray-300";this.riskLabel=e=>e>=61?"HIGH":e>=31?"MED":"LOW";this.riskClass=e=>e>=61?"bg-red-100 text-red-700":e>=31?"bg-amber-100 text-amber-700":"bg-green-100 text-green-700";this.api.list().subscribe(e=>this.all.set(e??[]))}onSearch(e){let t=e.target?.value??"";this.q.set(t)}resetData(){confirm("Reset all claims and policies to seed data?")&&this.http.post("/api/reset",{},{responseType:"text"}).subscribe({next:()=>this.api.list().subscribe(e=>this.all.set(e??[])),error:e=>alert("Reset failed: "+(e?.error?.message??e.statusText??e))})}onDelete(e){confirm(`Delete claim #${e}?`)&&this.api.delete(e).subscribe({next:()=>this.all.update(t=>t.filter(i=>i.id!==e)),error:t=>alert("Delete failed (check role/server): "+(t?.error?.message??t.statusText??t))})}exportCsv(){let e=this.rows();if(!e.length){alert("No rows to export.");return}let t=c=>{let h=c==null?"":String(c);return/[",\n]/.test(h)?`"${h.replace(/"/g,'""')}"`:h},l=[["id","policyNumber","lossDate","amount","status","assignee","riskScore"].join(",")];for(let c of e)l.push([t(c.id),t(c.policyNumber),t(c.lossDate),t(c.amount),t(c.status),t(c.assignee??""),t(c.riskScore??"")].join(","));let x=l.join(`
`),W=new Blob([x],{type:"text/csv;charset=utf-8;"}),I=URL.createObjectURL(W),b=document.createElement("a");b.href=I;let B=new Date().toISOString().slice(0,10);b.download=`claims-${B}.csv`,document.body.appendChild(b),b.click(),b.remove(),URL.revokeObjectURL(I)}};u.\u0275fac=function(t){return new(t||u)},u.\u0275cmp=T({type:u,selectors:[["app-claims-list"]],decls:10,vars:5,consts:[[1,"flex","justify-between","items-center","mb-4","gap-3"],[1,"text-xl","font-semibold"],[1,"flex-1"],["placeholder","Search by id, policy, status\u2026",1,"px-3","py-2","border","rounded","w-72",3,"input","value"],[1,"px-3","py-2","rounded","border","text-sm","cursor-pointer"],["class","px-3 py-2 rounded bg-rose-600 text-white text-sm cursor-pointer",3,"click",4,"ngIf"],["routerLink","/claims/new",1,"px-3","py-2","rounded","bg-blue-600","text-white","text-sm","cursor-pointer"],[1,"w-full","border","text-sm"],[1,"text-sm","text-gray-600"],[1,"px-3","py-2","rounded","border","text-sm","cursor-pointer",3,"click"],[1,"px-3","py-2","rounded","bg-rose-600","text-white","text-sm","cursor-pointer",3,"click"],[1,"bg-gray-50"],[1,"p-2","border","text-left"],[1,"p-2","border"],[1,"odd:bg-white","even:bg-gray-50"],[1,"px-2","py-0.5","rounded"],[1,"p-2","border","text-right","space-x-3"],[1,"text-blue-600","hover:underline",3,"routerLink"],["class","text-red-600 hover:underline cursor-pointer",3,"click",4,"ngIf"],[1,"text-red-600","hover:underline","cursor-pointer",3,"click"]],template:function(t,i){if(t&1&&(o(0,"div",0)(1,"h2",1),a(2,"Claims"),n(),w(3,"div",2),o(4,"input",3),_("input",function(x){return i.onSearch(x)}),n(),d(5,J,2,0,"button",4),E(6,K,2,0,"button",5),d(7,Q,2,0,"a",6),n(),d(8,te,18,1,"table",7)(9,ie,2,0,"div",8)),t&2){let l;s(4),C("value",i.q()),s(),p(i.roleSvc.role()==="Auditor"?5:-1),s(),C("ngIf",i.roleSvc.role()==="Manager"),s(),p(i.roleSvc.role()!=="Auditor"&&i.roleSvc.role()!=="Adjuster"?7:-1),s(),p((l=i.rows().length)?8:9,l)}},dependencies:[A,O,F],encapsulation:2,changeDetection:0});var U=u;export{U as ClaimsListComponent};
